import openai
import os
from dotenv import load_dotenv

# .env νμΌ λ΅λ“
load_dotenv()

# OpenAI API ν‚¤ μ„¤μ •
api_key = os.getenv("OPENAI_API_KEY")

# OpenAI ν΄λΌμ΄μ–ΈνΈ μ΄κΈ°ν™”
client = openai.OpenAI(api_key=api_key)

def summarize_text(input_text):
    """ OpenAI GPT-4o λ¨λΈμ„ μ‚¬μ©ν•μ—¬ μƒλ‹΄ λ‚΄μ©μ„ μ™„λ²½ν μ”μ•½ν•λ” ν•¨μ """
    try:
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": 
                    "μ£Όμ–΄μ§„ μƒλ‹΄ λ‚΄μ©μ„ μ™„λ²½ν•κ² μ •λ¦¬ν•΄μ¤. μƒλ‹΄ μ ν•(μΈν…λ¦¬μ–΄, λ²•λ¥ , κΈμµ, μλ£ λ“±)μ— κ΄€κ³„μ—†μ΄, "
                    "λ¨λ“  μ„Έλ¶€ λ‚΄μ©μ„ λΉ μ§μ—†μ΄ ν¬ν•¨ν•΄μ•Ό ν•΄.\n\n"
                    "π“ 1. μƒλ‹΄ κ°μ”\n"
                    "- μƒλ‹΄μ ν•µμ‹¬ λ‚΄μ©μ„ 3~5μ¤„ μ΄λ‚΄λ΅ μ”μ•½\n"
                    "- μ£Όμ” λΉ„μ©, μΌμ •, κ³„μ•½ λ³€κ²½ μ‚¬ν•­ λ“±μ„ ν¬ν•¨ν•  κ²ƒ\n\n"
                    "π“ 2. μƒλ‹΄ μƒμ„Έ λ‚΄μ©\n"
                    "- λ€ν™”μ λ¨λ“  λ‚΄μ©μ„ λ²νΈ(1,2,3,4,...)λ΅ μ •λ¦¬ν•΄μ•Ό ν•¨.\n"
                    "- μƒλ‹΄μ—μ„ λ…Όμλ λ¨λ“  λ‚΄μ©μ΄ ν¬ν•¨λμ–΄μ•Ό ν•λ©°, μ‘μ€ μ„Έλ¶€μ‚¬ν•­λ„ λΉ λ¨λ¦¬μ§€ λ§ κ²ƒ.\n"
                    "- λΉ„μ©(κΈμ•΅), μΌμ •(λ‚ μ§), κ³„μ•½ μ΅°κ±΄ λ“±μ μ«μλ” μ λ€ λ„λ½ν•μ§€ λ§ κ²ƒ.\n\n"
                    "μμ‹:\n"
                    "1. **λ°©λ²” λ°©μ¶©λ§ κ΄€λ ¨ λ…Όμ**\n"
                    "   - ν„κ΄€ λ°©λ²” λ°©μ¶©λ§ κ°€κ²©: 32λ§ μ›\n"
                    "   - μ‘μ€ λ°© λ°©μ¶©λ§ κ°€κ²©: 40λ§ μ›\n"
                    "   - κ±°μ‹¤ λ°©λ²” λ°©μ¶©λ§ κ°€κ²©: 55λ§ μ› (μ΄ 143λ§ μ› VAT ν¬ν•¨)\n"
                    "2. **ν—λ‹μ½¤ λΈ”λΌμΈλ“ μ„¤μΉ μ”μ²­**\n"
                    "   - κ±°μ‹¤ ν™•μ¥λ¶€ μ°½: 40λ§ μ›, μ¶”κ°€ κ³µκ°„ μ„¤μΉ μ—¬λ¶€ λ…Όμ μ¤‘\n"
                    "3. **κ³µμ‚¬ μΌμ • μ΅°μ¨**\n"
                    "   - κΈ°μ΅΄ κ³µμ‚¬ μ‹μ‘μΌ: 10μ›” 31μΌ β†’ λ³€κ²½ μ”μ²­: 10μ›” 28μΌ\n"
                    "   - κ³ κ° μ΄μ‚¬μΌ: 10μ›” 29μΌ, κ³µμ‚¬μ™€μ μ΅°μ¨ ν•„μ”\n"
                    "...\n"
                    "(μ„μ™€ κ°™μ€ λ°©μ‹μΌλ΅ **λ¨λ“  μƒλ‹΄ λ‚΄μ©μ„ λΉ μ§μ—†μ΄ μ”μ•½**ν•  κ²ƒ)"},
                {"role": "user", "content": input_text}
            ]
        )
        return response.choices[0].message.content
    except Exception as e:
        print(f"β μ”μ•½ μ¤λ¥: {e}")
        return "μ”μ•½ μ‹¤ν¨"
